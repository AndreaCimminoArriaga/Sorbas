# Sorbas

Sorbas learns context-aware rules that are building on top of state-of-the-art incontextual rules, which can be learnt by any of the state-of-the-art proposals. By contextaware, we reffer that context-aware rules take into account the attributes of the resources being linked and the attributes of their neighbours.

## Building Sorbas 

Sorbas is made of four executable jars, namely:

* sorbasRL: learns the context-aware rules
* sorbasRL-OO: optimises the overlap threhold once sorbasRL has provided a context-aware rule
* sorbasRL-DO; optimises the gamma threhold once sorbasRL has provided a context-aware rule
* sorbas: given a context-aware rule, a overlap threshold, and a gamma threshold this component links two datasets

To build the previous executables first download this project and open it into you IDE, once is opened: compile as a runnable jar the class 'SorbasRLMain.jar' an call it sorbasRL.jar, compile as a runnable jar the class 'OverlapOptimizatorMain.jar' an call it sorbasRL-OO.jar, compile as a runnable jar the class 'DOptimizatorMain.jar' and call it sorbasRL-DO.jar, and finally, compile as a runnable jar the class 'SorbasRAMain.jar' and call it sorbas.jar,



## Running an example

We have inlcuded a scenario this readme to ilustrate how Sorbas can be run, the scenarios is 'Restaurants'. All scenarios ready to run can be found [here](https://zenodo.org/record/2555034#.XFgFjc9Khz8)

To run this example download the restaurants.zip, move to the training directory and just type in your console

```
java -jar sorbasRL.jar restaurants-input.json 0.01 0.01
```

The first argument is a file input (which we will explain later), the seccond the overlap threshold, and the thrid is the gamma threshold. To obtain the best parameter values you can use sorbasRL-OO.jar and sorbasRL-DO.jar. First, execute sorbasRL-OO.jar as follows

```
java -jar sorbasRL-OO.jar restaurants-input.json > oo-optimisation.txt
```

Then, open the file oo-optimisation.txt and check which value fits better for the overlap threshold; the file oo-optimisation.txt contains for each possible threshold value a related confusion matrix. After selecting the best overlap threshold execute sorbasRL-DO.jar as follows (where best_threshold is the value selected)
```
java -jar sorbasRL-DO.jar restaurants-input.json best_o_threshold > do-optimisation.txt
```
Similarly as before select from do-optimisation.txt the best value. Finally to obtain the best learning results you can re-execute sorbasRL using

```
java -jar sorbasRL.jar restaurants-input.json best_o_threshold best_d_threshold
```
Where best_d_threshold is the best gamma threshold selected from do-optimisation.txt.

### Linking

To link two datasets use sorbas with the output of sorbasRL.jar, which will be the file called \*-filtered.json as follows. Move to the valication directory in the restaurants scenario and type the following:

```
java -jar sorbas.jar restaurants-input.json best_o_threshold best_d_threshold
```

### Checking results

After the execution of sorbasRL.jar and sorbas.jar a file will be created in the output folder, i.e., restaurants in our case, the file named effectiveness.csv contain the effectiveness of the basic rule (learnt with any state-of-the-art proposal) and the effectiveness of the sorbas learnt rule. In addition, to check the execution time there is a file named log that contains the trace of the execution, including the time required to learn or apply context-aware link rules

## Inputs

Having the sorbasRL.jar you only need to pass as argument an input file with the setup of the algorithm. The input file is a json file that must contain the following data:

 * resultsFile: where the effectiveness achived by the main rule and our techniques will be stored.
 * sampleFile: containin saple links used to compute the effectiveness, the sample links are owl:sameAs or owl:differentFrom.
 * linksFile: is not required in this experiments as long as Sorbas will inject this value in running time.
 * searchForward: explore the RDF graphs (neighbours of the resources) following the direction of the object properties.
 * searchBackward: explore the RDF graphs (neighbours of the resources) following the oposite direction of the object properties.
 * maxSerachDepth: maximum depth of an RDF graph to explore.
 * resultsFolder: an existing folder where the outcome of Sorbas will be store.
 * outputMainRuleLinks: specifies if links generated by the main link rule must be stored in a file.
 * outputMainRuleLinksFile: specifies where the links generated by the main link rule will be stored.
 * filteredLinksFile: specifies where the links generated by Sorbas will be stored.
 * sourceDataset/targetDataset: specify where the source and target Jena TDB datasets are.
 * mainLinkRule: specifies a main link rule.
 * supportingRules: specifies an array of link rules to assist the main link rule to improve its precision when linking.

Relying on our 'Restaurants' test, its input file 'restaurants-input.json' is as follows:

```
{
	"links-evaluator" : {
		"resultsFile" : "restaurants/effectiveness.csv",
		"goldStandardFile" : "restaurants/restaurants-gold.nt",
		"linksFile" : "[Dynamically injected by Sorbas]",
	},
	"pathfinder" : {
		"searchForward" : "true",
		"searchBackwards" : "true",
		"maxSerachDepth" : "10"
	},
	"resultsFolder"  : "restaurants",
	"outputMainRuleLinks"  :"true",
	"outputMainRuleLinksFile" : "restaurants/mainLinks.nt",
	"filteredLinksFile" : "restaurants/filtered.nt",
	"sourceDataset"  : "tdb-data/restaurants1",
	"targetDataset"  : "tdb-data/restaurants2",
	"mainLinkRule"  : {
			"sourceClasses" : ["http://www.okkam.org/ontology_restaurant1.owl#Restaurant"],
			"targetClasses" : ["http://www.okkam.org/ontology_restaurant2.owl#Restaurant"],
			"restriction" : "agg:Mult(str:JaroWinklerTFIDFSimilarity(http://www.okkam.org/ontology_restaurant1.owl#name,http://www.okkam.org/ontology_restaurant2.owl#name,0.8),0.62)"
	},
	"supportingRules" : [
			{
				"sourceClasses" : ["http://www.okkam.org/ontology_restaurant1.owl#Address"],
				"targetClasses" : ["http://www.okkam.org/ontology_restaurant2.owl#Address"],
				"restriction" : "agg:Mult(str:JaroWinklerTFIDFSimilarity(http://www.okkam.org/ontology_restaurant1.owl#street,http://www.okkam.org/ontology_restaurant2.owl#street,0.8),0.62)"
			},
			{
				"sourceClasses" : ["http://www.okkam.org/ontology_restaurant1.owl#City"],
				"targetClasses" : ["http://www.okkam.org/ontology_restaurant2.owl#Address"],
				"restriction" : "agg:Mult(str:JaroWinklerTFIDFSimilarity(http://www.okkam.org/ontology_restaurant1.owl#name,http://www.okkam.org/ontology_restaurant2.owl#city,0.8),0.62)"
			}
		],
 
}
```

To build link rules Sorbas relies on the following functions:

#### Aggregate metrics
 * agg:Avg
 * agg:Max
 * agg:Min
 * agg:Mult

#### String metrics:
 * str:CosineSimilarity
 * str:JaccardSimilarity
 * str:JaroSimilarity
 * str:JaroWinklerSimilarity
 * str:JaroWinklerTFIDFSimilarity
 * str:LevenshteinSimilarity
 * str:OverlapSimilarity
 * str:QGramsSimilarity
 * str:SoftTFIDFSimilarity
 * str:SubstringSimilarity
 * str:TrigramsSimilarity

#### Transformation metrics:
 * trn:LowercaseTransformation
 * trn:RemoveSymbolsTransformation
 * trn:StemTransformation
 * trn:StripUriPrefixTransformation
 * trn:TokenizeTransformation
 * trn:UpercaseTransformation


Finally the output of sorbasRL will be a file similar to the following, which will be the input of sorbas.jar:

```
{
	"links-evaluator" : {
			"resultsFile" : "restaurants/effectiveness.csv",
			"goldStandardFile" : "restaurants/restaurants-training.nt",
			"linksFile" : ""
	},
	"resultsFolder":"restaurants",
	"outputMainRuleLinks":"true",
	"outputMainRuleLinksFile":"restaurants/mainLinks.nt",
	"filteredLinksFile":"restaurants/filtered.nt",
	"sourceDataset":"tdb-data/restaurants1",
	"targetDataset":"tdb-data/restaurants2",
	"mainLinkRule":{
			"sourceClasses":["http://www.okkam.org/ontology_restaurant1.owl#Restaurant"],
			"targetClasses":["http://www.okkam.org/ontology_restaurant2.owl#Restaurant"],
			"restriction" : "str:JaroWinklerTFIDFSimilarity(http://www.okkam.org/ontology_restaurant1.owl#name,http://www.okkam.org/ontology_restaurant2.owl#name,0.77)"
	},
	"supportingRules" : [ {
				"sourcePath":["?R950 <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.okkam.org/ontology_restaurant1.owl#Restaurant>","?R950 <http://www.okkam.org/ontology_restaurant1.owl#has_address> ?L5"],
				"targetPath":["?Jn2 <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.okkam.org/ontology_restaurant2.owl#Restaurant>","?Jn2 <http://www.okkam.org/ontology_restaurant2.owl#has_address> ?r11"],
				"restriction" : "str:SoftTFIDFSimilarity(http://www.okkam.org/ontology_restaurant1.owl#street,http://www.okkam.org/ontology_restaurant2.owl#street,0.71)"
		},{
				"sourcePath":["?it2 <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.okkam.org/ontology_restaurant1.owl#Restaurant>","?it2 <http://www.okkam.org/ontology_restaurant1.owl#has_address> ?Bh86","?Bh86 <http://www.okkam.org/ontology_restaurant1.owl#is_in_city> ?Tw762"],
				"targetPath":["?eHY694 <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.okkam.org/ontology_restaurant2.owl#Restaurant>","?eHY694 <http://www.okkam.org/ontology_restaurant2.owl#has_address> ?BZi8"],
				"restriction" : "str:SoftTFIDFSimilarity(http://www.okkam.org/ontology_restaurant1.owl#name,http://www.okkam.org/ontology_restaurant2.owl#city,0.72)"
		}
	]
}
```
## Experiment Files

In our experiments we have two different folders, training and validation. We have trained sorbasRL with the training folder, and used sorbas in the validation folder. The folders training-bis and validation-bis contain the results of applying another approach to the same datastes (not learning, just applying the technique to link the sample instances) and compare the results with the ones achieved by Sorbas.

## Authors
 * **[Andrea Cimmino](http://www.tdg-seville.info/acimmino/Home)**

## License

This project is licensed under TDG's License - visit http://www.tdg-seville.info/license.html for details

## Acknowledgments
 * Special thanks to [Dr. Rafael Corchuelo](http://www.tdg-seville.info/corchu/Home)
 * Spanish R&D programme (grants TIN2013-40848-R and TIN2016-75394-R)
